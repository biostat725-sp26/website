<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Sam Berchuck">

<title>Markov chain Monte Carlo – BIOSTAT 725 - Spring 2026</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Markov chain Monte Carlo</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostat725-sp26" title="GitHub organization" class="quarto-navigation-tool px-1" aria-label="GitHub organization"><i class="bi bi-github"></i></a>
    <a href="https://cmgr.oit.duke.edu/containers" title="RStudio Containers" class="quarto-navigation-tool px-1" aria-label="RStudio Containers"><i class="bi bi-code-square"></i></a>
    <a href="https://edstem.org/us/courses/68995/discussion/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-chat-dots-fill"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-check-square-fill"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://canvas.duke.edu/courses/53305">
            Canvas
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.gradescope.com/courses/903622">
            Gradescope
            </a>
          </li>
      </ul>
    </div>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Support</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Useful links</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Computing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-r-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Homework</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 00</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 05</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../live-coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Live-Coding</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review-of-last-lecture" id="toc-review-of-last-lecture" class="nav-link active" data-scroll-target="#review-of-last-lecture">Review of last lecture</a></li>
  <li><a href="#bayesian-linear-regression" id="toc-bayesian-linear-regression" class="nav-link" data-scroll-target="#bayesian-linear-regression">Bayesian Linear Regression</a>
  <ul class="collapse">
  <li><a href="#defining-the-model" id="toc-defining-the-model" class="nav-link" data-scroll-target="#defining-the-model">Defining the model</a></li>
  <li><a href="#defining-the-likelihood" id="toc-defining-the-likelihood" class="nav-link" data-scroll-target="#defining-the-likelihood">Defining the likelihood</a></li>
  <li><a href="#matrix-likelihood-specification" id="toc-matrix-likelihood-specification" class="nav-link" data-scroll-target="#matrix-likelihood-specification">Matrix likelihood specification</a></li>
  <li><a href="#linear-regression-estimation" id="toc-linear-regression-estimation" class="nav-link" data-scroll-target="#linear-regression-estimation">Linear regression estimation</a></li>
  <li><a href="#linear-regression-assumptions" id="toc-linear-regression-assumptions" class="nav-link" data-scroll-target="#linear-regression-assumptions">Linear regression assumptions</a></li>
  <li><a href="#posterior-for-linear-regression" id="toc-posterior-for-linear-regression" class="nav-link" data-scroll-target="#posterior-for-linear-regression">Posterior for linear regression</a></li>
  </ul></li>
  <li><a href="#gibbs-sampling" id="toc-gibbs-sampling" class="nav-link" data-scroll-target="#gibbs-sampling">Gibbs Sampling</a>
  <ul class="collapse">
  <li><a href="#motivation-for-gibbs-sampling" id="toc-motivation-for-gibbs-sampling" class="nav-link" data-scroll-target="#motivation-for-gibbs-sampling">Motivation for Gibbs sampling</a></li>
  <li><a href="#gibbs-sampler-for-linear-regression" id="toc-gibbs-sampler-for-linear-regression" class="nav-link" data-scroll-target="#gibbs-sampler-for-linear-regression">Gibbs sampler for linear regression</a></li>
  <li><a href="#why-does-this-work" id="toc-why-does-this-work" class="nav-link" data-scroll-target="#why-does-this-work">Why does this work?</a></li>
  <li><a href="#gibbs-sampler" id="toc-gibbs-sampler" class="nav-link" data-scroll-target="#gibbs-sampler">Gibbs sampler</a></li>
  <li><a href="#gibbs-sampler-1" id="toc-gibbs-sampler-1" class="nav-link" data-scroll-target="#gibbs-sampler-1">Gibbs sampler</a></li>
  <li><a href="#gibbs-sampler-for-linear-regression-1" id="toc-gibbs-sampler-for-linear-regression-1" class="nav-link" data-scroll-target="#gibbs-sampler-for-linear-regression-1">Gibbs sampler for linear regression</a></li>
  <li><a href="#full-conditional-for-boldsymbolbeta" id="toc-full-conditional-for-boldsymbolbeta" class="nav-link" data-scroll-target="#full-conditional-for-boldsymbolbeta">Full conditional for <span class="math inline">\(\boldsymbol{\beta}\)</span></a></li>
  <li><a href="#full-conditional-for-boldsymbolbeta-1" id="toc-full-conditional-for-boldsymbolbeta-1" class="nav-link" data-scroll-target="#full-conditional-for-boldsymbolbeta-1">Full conditional for <span class="math inline">\(\boldsymbol{\beta}\)</span></a></li>
  <li><a href="#full-conditional-for-sigma2" id="toc-full-conditional-for-sigma2" class="nav-link" data-scroll-target="#full-conditional-for-sigma2">Full conditional for <span class="math inline">\(\sigma^2\)</span></a></li>
  <li><a href="#sampling-from-the-posterior" id="toc-sampling-from-the-posterior" class="nav-link" data-scroll-target="#sampling-from-the-posterior">Sampling from the posterior</a></li>
  <li><a href="#visualize-simulated-data" id="toc-visualize-simulated-data" class="nav-link" data-scroll-target="#visualize-simulated-data">Visualize simulated data</a></li>
  <li><a href="#inspecting-the-prior" id="toc-inspecting-the-prior" class="nav-link" data-scroll-target="#inspecting-the-prior">Inspecting the prior</a></li>
  <li><a href="#perform-gibbs-sampling" id="toc-perform-gibbs-sampling" class="nav-link" data-scroll-target="#perform-gibbs-sampling">Perform Gibbs sampling</a></li>
  <li><a href="#inspect-results" id="toc-inspect-results" class="nav-link" data-scroll-target="#inspect-results">Inspect results</a></li>
  <li><a href="#summary-of-gibbs-sampling" id="toc-summary-of-gibbs-sampling" class="nav-link" data-scroll-target="#summary-of-gibbs-sampling">Summary of Gibbs sampling</a></li>
  </ul></li>
  <li><a href="#metropolis-sampling" id="toc-metropolis-sampling" class="nav-link" data-scroll-target="#metropolis-sampling">Metropolis sampling</a>
  <ul class="collapse">
  <li><a href="#intuition-behind-metropolis-sampling" id="toc-intuition-behind-metropolis-sampling" class="nav-link" data-scroll-target="#intuition-behind-metropolis-sampling">Intuition behind Metropolis sampling</a></li>
  <li><a href="#metropolis-acceptance-ratio" id="toc-metropolis-acceptance-ratio" class="nav-link" data-scroll-target="#metropolis-acceptance-ratio">Metropolis acceptance ratio</a></li>
  <li><a href="#metropolis-intuition" id="toc-metropolis-intuition" class="nav-link" data-scroll-target="#metropolis-intuition">Metropolis intuition</a></li>
  <li><a href="#metropolis-update" id="toc-metropolis-update" class="nav-link" data-scroll-target="#metropolis-update">Metropolis update</a></li>
  <li><a href="#metropolis-proposal-distribution" id="toc-metropolis-proposal-distribution" class="nav-link" data-scroll-target="#metropolis-proposal-distribution">Metropolis proposal distribution</a></li>
  <li><a href="#metropolis-and-gibbs-combined" id="toc-metropolis-and-gibbs-combined" class="nav-link" data-scroll-target="#metropolis-and-gibbs-combined">Metropolis and Gibbs combined</a></li>
  <li><a href="#linear-regression-using-metropolisgibbs" id="toc-linear-regression-using-metropolisgibbs" class="nav-link" data-scroll-target="#linear-regression-using-metropolisgibbs">Linear regression using Metropolis/Gibbs</a></li>
  <li><a href="#linear-regression-using-metropolisgibbs-1" id="toc-linear-regression-using-metropolisgibbs-1" class="nav-link" data-scroll-target="#linear-regression-using-metropolisgibbs-1">Linear regression using Metropolis/Gibbs</a></li>
  <li><a href="#inspect-results-1" id="toc-inspect-results-1" class="nav-link" data-scroll-target="#inspect-results-1">Inspect results</a></li>
  <li><a href="#summary-of-metropolis-algorithm" id="toc-summary-of-metropolis-algorithm" class="nav-link" data-scroll-target="#summary-of-metropolis-algorithm">Summary of Metropolis algorithm</a></li>
  <li><a href="#metropolis-hastings-mh-algorithm" id="toc-metropolis-hastings-mh-algorithm" class="nav-link" data-scroll-target="#metropolis-hastings-mh-algorithm">Metropolis-Hastings (MH) algorithm</a></li>
  <li><a href="#hamiltonian-monte-carlo-hmc-intuition" id="toc-hamiltonian-monte-carlo-hmc-intuition" class="nav-link" data-scroll-target="#hamiltonian-monte-carlo-hmc-intuition">Hamiltonian Monte Carlo (HMC) intuition</a></li>
  <li><a href="#hmc-intuition" id="toc-hmc-intuition" class="nav-link" data-scroll-target="#hmc-intuition">HMC intuition</a></li>
  <li><a href="#prepare-for-next-class" id="toc-prepare-for-next-class" class="nav-link" data-scroll-target="#prepare-for-next-class">Prepare for next class</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/biostat725-sp26/website/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="03-mcmc.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Markov chain Monte Carlo</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Sam Berchuck </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Jan 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="review-of-last-lecture" class="level2">
<h2 class="anchored" data-anchor-id="review-of-last-lecture">Review of last lecture</h2>
<ul>
<li><p>On Tuesday, we performed posterior inference for a Beta-Binomial model using Monte Carlo estimation.</p></li>
<li><p>Today we will discuss Bayesian estimation of linear regression:</p></li>
</ul>
<p><span class="math display">\[\mathbf{Y} | \boldsymbol{\beta}, \sigma^2 \sim N(\mathbf{X} \boldsymbol{\beta}, \sigma^2 \mathbf{I}_n).\]</span></p>
<ul>
<li><p>There is no closed form posterior, so we cannot directly use Monte Carlo sampling.</p></li>
<li><p>We need Markov chain Monte Carlo (MCMC)!</p></li>
<li><p>Our goal is to gain intuition behind MCMC, the workhorse behind Stan.</p></li>
</ul>
</section>
<section id="bayesian-linear-regression" class="level1">
<h1>Bayesian Linear Regression</h1>
<section id="defining-the-model" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-model">Defining the model</h2>
<p>Suppose we have an observation <span class="math inline">\(Y_i\)</span> for subject <span class="math inline">\(i\)</span> (<span class="math inline">\(i=1,\ldots,n\)</span>), that is modeled as follows,</p>
<p><span class="math display">\[\begin{aligned}
Y_i &amp;= \beta_0 + x_{i1} \beta_1 + \cdots + x_{ip} \beta_p + \epsilon_i, \quad \epsilon_i \sim N(0, \sigma^2)\\
&amp;= \mathbf{x}_i \boldsymbol{\beta} + \epsilon_i.
\end{aligned}\]</span></p>
<ul>
<li><span class="math inline">\(\mathbf{x}_i = (1, x_{i1},\ldots,x_{ip})\)</span> is a <span class="math inline">\((p+1)\)</span>-dimensional row vector of covariates (and intercept).</li>
<li><span class="math inline">\(\boldsymbol{\beta} = (\beta_0, \beta_1,\ldots,\beta_p)^\top\)</span> is a <span class="math inline">\((p+1)\)</span>-dimensional column vector of population regression parameters.</li>
<li><span class="math inline">\(\epsilon_i\)</span> is a Gaussian measurement error term with variance <span class="math inline">\(\sigma^2\)</span>.</li>
</ul>
</section>
<section id="defining-the-likelihood" class="level2">
<h2 class="anchored" data-anchor-id="defining-the-likelihood">Defining the likelihood</h2>
<p>The individual likelihood contribution for subject <span class="math inline">\(i\)</span> is given by,</p>
<p><span class="math display">\[Y_i|\boldsymbol{\beta},\sigma^2 \stackrel{ind}{\sim} N(\mathbf{x}_i \boldsymbol{\beta}, \sigma^2) \Leftrightarrow f(Y_i|\boldsymbol{\beta},\sigma^2) = N(\mathbf{x}_i \boldsymbol{\beta}, \sigma^2),\]</span> and the full data likelihood (or observed data likelihood) is given by, <span class="math display">\[f(\mathbf{Y} | \boldsymbol{\beta},\sigma^2) = \prod_{i=1}^n f(Y_i|\boldsymbol{\beta},\sigma^2),\]</span> where <span class="math inline">\(\mathbf{Y} = (Y_1,\ldots,Y_n)\)</span>.</p>
</section>
<section id="matrix-likelihood-specification" class="level2">
<h2 class="anchored" data-anchor-id="matrix-likelihood-specification">Matrix likelihood specification</h2>
<p>We can also write the likelihood directly, <span class="math display">\[\mathbf{Y} | \boldsymbol{\beta},\sigma^2 \sim N(\mathbf{X} \boldsymbol{\beta}, \sigma^2 \mathbf{I}_n),\]</span> where <span class="math inline">\(\mathbf{X}\)</span> is an <span class="math inline">\(n \times (p + 1)\)</span> dimensional matrix with row <span class="math inline">\(\mathbf{x}_i\)</span> and <span class="math inline">\(\mathbf{I}_n\)</span> is an <span class="math inline">\(n\)</span>-dimensional identity matrix. Thus, the mean of the observed data is modeled as a linear function of the parameters,</p>
<p><span class="math display">\[
\mathbb{E}[ \mathbf{Y} | \boldsymbol{\beta},\sigma^2 ]  =
  \begin{bmatrix}
    1 &amp; x_{12} &amp; \ldots &amp; x_{1p} \\
    1 &amp; x_{22} &amp; \ldots &amp; x_{2p} \\
    \vdots &amp; \vdots &amp; &amp; \vdots\\
    1 &amp; x_{n2} &amp; \ldots &amp; x_{np}
  \end{bmatrix}
    \begin{bmatrix}
    \beta_0\\
    \beta_1\\
    \vdots\\
    \beta_p
  \end{bmatrix} = \mathbf{X} \boldsymbol{\beta}.
\]</span></p>
</section>
<section id="linear-regression-estimation" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-estimation">Linear regression estimation</h2>
<ul>
<li>Ordinary least squares (OLS)</li>
</ul>
<center>
<span class="math inline">\(\hat{\boldsymbol{\beta}}_{\text{OLS}} = \underset{\boldsymbol{\beta}}{\operatorname{argmin}} || \mathbf{Y} - \mathbf{X}\boldsymbol{\beta}||^2\)</span>
</center>
<ul>
<li>Maximum likelihood estimation (MLE)</li>
</ul>
<center>
<span class="math inline">\(\hat{\boldsymbol{\beta}}_{\text{MLE}} = \underset{\boldsymbol{\beta}}{\operatorname{argmax}} \log f(\mathbf{Y} | \boldsymbol{\beta})\)</span>
</center>
<ul>
<li><span class="math inline">\(\hat{\boldsymbol{\beta}}_{\text{OLS}} = \hat{\boldsymbol{\beta}}_{\text{MLE}} = (\mathbf{X}^\top \mathbf{X})^{-1}\mathbf{X}^\top \mathbf{Y}\)</span></li>
</ul>
</section>
<section id="linear-regression-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-assumptions">Linear regression assumptions</h2>
<ol type="1">
<li><p>Linearity between <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>: <span class="math inline">\(\mathbf{Y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{\epsilon}\)</span></p></li>
<li><p>Independence of errors: <span class="math inline">\(\epsilon_i\)</span>’s are independent Gaussian</p></li>
<li><p>Homoskedasticity: constant <span class="math inline">\(\sigma^2\)</span> across <span class="math inline">\(\mathbf{x}_i\)</span></p></li>
<li><p>Normality of errors: <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span></p></li>
<li><p>No multicollinearity: <span class="math inline">\(\left(\mathbf{X}^\top \mathbf{X}\right)^{-1}\)</span> exists</p></li>
</ol>
</section>
<section id="posterior-for-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="posterior-for-linear-regression">Posterior for linear regression</h2>
<p><span class="math display">\[\begin{aligned}
f(\boldsymbol{\beta}, \sigma^2 | \mathbf{Y}) &amp;= \frac{f(\mathbf{Y}, \boldsymbol{\beta}, \sigma^2)}{f(\mathbf{Y})}\\
&amp;= \frac{f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\boldsymbol{\beta}, \sigma^2)}{f(\mathbf{Y})}\\
&amp;= \frac{f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\boldsymbol{\beta}, \sigma^2)}{\int f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\boldsymbol{\beta}, \sigma^2)d\boldsymbol{\beta}d\sigma^2}.
\end{aligned}\]</span></p>
<p>No closed form exists for the posterior. <span class="math display">\[f(\boldsymbol{\beta}, \sigma^2 | \mathbf{Y}) \propto f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\boldsymbol{\beta}, \sigma^2)\]</span></p>
</section>
</section>
<section id="gibbs-sampling" class="level1">
<h1>Gibbs Sampling</h1>
<section id="motivation-for-gibbs-sampling" class="level2">
<h2 class="anchored" data-anchor-id="motivation-for-gibbs-sampling">Motivation for Gibbs sampling</h2>
<ul>
<li><p>Suppose we were given <span class="math inline">\(\sigma^{2(1)}\)</span>, a single sample from the marginal posterior distribution <span class="math inline">\(f\left(\sigma^2|\mathbf{Y}\right)\)</span> (from where, who knows?)</p></li>
<li><p>Use the sample to generate <span class="math inline">\(\boldsymbol{\beta}^{(1)}\)</span> from <span class="math inline">\(f\left(\boldsymbol{\beta}|\mathbf{Y},\sigma^{2(1)}\right)\)</span></p></li>
<li><p><span class="math inline">\(\left(\boldsymbol{\beta}^{(1)},\sigma^{2(1)}\right)\)</span> is a sample from <span class="math inline">\(f\left(\boldsymbol{\beta}, \sigma^2 | \mathbf{Y}\right)\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{\beta}^{(1)}\)</span> is a sample from <span class="math inline">\(f\left(\boldsymbol{\beta} | \mathbf{Y}\right)\)</span></p></li>
</ul>
<p>. . .</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recall
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(f\left(\boldsymbol{\beta}, \sigma^{2}|\mathbf{Y}\right) = f\left(\boldsymbol{\beta} | \sigma^{2},\mathbf{Y}\right)f\left(\sigma^{2}|\mathbf{Y}\right)\)</span></p>
</div>
</div>
</section>
<section id="gibbs-sampler-for-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler-for-linear-regression">Gibbs sampler for linear regression</h2>
<p>Suppose we can sample from the following two distributions,</p>
<ol type="1">
<li><p><span class="math inline">\(f(\boldsymbol{\beta} | \mathbf{Y}, \sigma^2) \propto f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\boldsymbol{\beta})\)</span></p></li>
<li><p><span class="math inline">\(f(\sigma^2 | \mathbf{Y}, \boldsymbol{\beta}) \propto f(\mathbf{Y} | \boldsymbol{\beta}, \sigma^2) f(\sigma^2)\)</span></p></li>
</ol>
<p>These are called <strong>full conditional distributions</strong>.</p>
<p>Set initial values for <span class="math inline">\(\boldsymbol{\theta}^{(0)} = (\boldsymbol{\beta}^{(0)}, \sigma^{2(0)})\)</span>. Then, given a current state of parameters <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>, we can generate a new state as follows:</p>
<ol type="1">
<li><p>Sample <span class="math inline">\(\boldsymbol{\beta}^{(s + 1)} \sim f(\boldsymbol{\beta} | \mathbf{Y}, \sigma^{2(s)})\)</span></p></li>
<li><p>Sample <span class="math inline">\(\sigma^{2(s + 1)} \sim f(\sigma^2 | \mathbf{Y}, \boldsymbol{\beta}^{(s + 1)})\)</span></p></li>
<li><p>Let <span class="math inline">\(\boldsymbol{\theta}^{(s+1)} = (\boldsymbol{\beta}^{(s + 1)}, \sigma^{2(s + 1)})\)</span></p></li>
</ol>
</section>
<section id="why-does-this-work" class="level2">
<h2 class="anchored" data-anchor-id="why-does-this-work">Why does this work?</h2>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\theta}^{(0)}\)</span> isn’t a sample from the posterior, it is an arbitrarily chosen initial value</p></li>
<li><p><span class="math inline">\(\boldsymbol{\theta}^{(1)}\)</span> likely isn’t from the posterior either. Its distribution depends on <span class="math inline">\(\boldsymbol{\theta}^{(0)}\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{\theta}^{(2)}\)</span> likely isn’t from the posterior either. Its distribution depends on <span class="math inline">\(\boldsymbol{\theta}^{(0)}\)</span> and <span class="math inline">\(\boldsymbol{\theta}^{(1)}\)</span></p></li>
<li><p><strong>Theorem:</strong> For any initial values, the chain will eventually converge to the posterior</p></li>
<li><p><strong>Theorem:</strong> If <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> is a sample from the posterior, then <span class="math inline">\(\boldsymbol{\theta}^{(s+1)}\)</span> is too</p></li>
</ul>
</section>
<section id="gibbs-sampler" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler">Gibbs sampler</h2>
<ul>
<li><p>Under mild regulatory conditions that are generally satisfied for most statistical models, one can show that the iteration <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> converges in distribution to a draw from the true joint posterior distribution</p></li>
<li><p>So for <span class="math inline">\(s\)</span> sufficiently large (say, bigger than <span class="math inline">\(s_0\)</span>), <span class="math inline">\(\left\{\boldsymbol{\theta}^{(s)}, s=s_0+1,\ldots,S\right\}\)</span> is a <strong>correlated</strong> sample from the true joint posterior (and <span class="math inline">\(\boldsymbol{\beta}^{(s)}\)</span> and <span class="math inline">\(\sigma^{2(s)}\)</span> are samples from the marginals)</p></li>
<li><p>Similar to Monte Carlo approximation, we can use these samples to estimate posterior quantities of interest</p></li>
</ul>
</section>
<section id="gibbs-sampler-1" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler-1">Gibbs sampler</h2>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\theta}^{(t)}\)</span> depends on <span class="math inline">\(\boldsymbol{\theta}^{(0)},\ldots,\boldsymbol{\theta}^{(t-1)}\)</span> only through <span class="math inline">\(\boldsymbol{\theta}^{(t-1)}\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{\theta}^{(t)}\)</span> is conditionally independent of <span class="math inline">\(\boldsymbol{\theta}^{(0)},\ldots,\boldsymbol{\theta}^{(t-2)}\)</span> given <span class="math inline">\(\boldsymbol{\theta}^{(t-1)}\)</span></p>
<p><span class="math inline">\(\implies\)</span> Markov property, so the sequence is called a Markov chain</p></li>
<li><p>We use the samples similar to MC approximation; therefore, Gibbs sampling is a form of Markov chain Monte Carlo (MCMC)</p></li>
<li><p>We will cover diagnostics for MCMC in another lecture!</p></li>
</ul>
</section>
<section id="gibbs-sampler-for-linear-regression-1" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler-for-linear-regression-1">Gibbs sampler for linear regression</h2>
<ul>
<li><p>We need to compute the full conditionals. Before doing this, we require prior distributions.</p></li>
<li><p>Let’s assume that the prior for <span class="math inline">\(\boldsymbol{\beta}\)</span> is Gaussian,</p></li>
</ul>
<p><span class="math display">\[f(\boldsymbol{\beta}) = N(\boldsymbol{\beta}_0,\sigma_{\beta}^2 \mathbf{I}_{p+1}).\]</span></p>
<ul>
<li><span class="math inline">\(\boldsymbol{\beta}_0\)</span> is the prior mean (i.e., our a-priori guess for the likely value of <span class="math inline">\(\boldsymbol{\beta}\)</span>)</li>
<li><span class="math inline">\(\sigma_{\beta}^2\)</span> is the prior variance (i.e., encodes our certainty for our a-priori guess)</li>
</ul>
</section>
<section id="full-conditional-for-boldsymbolbeta" class="level2 small">
<h2 class="small anchored" data-anchor-id="full-conditional-for-boldsymbolbeta">Full conditional for <span class="math inline">\(\boldsymbol{\beta}\)</span></h2>
<p><span class="math display">\[\begin{aligned}
f(\boldsymbol{\beta},\sigma^2 | \mathbf{Y}) &amp;\propto f(\mathbf{Y} | \boldsymbol{\beta},\sigma^2) f(\boldsymbol{\beta})\\
&amp;\propto \exp\left\{-\frac{1}{2}\left[\frac{\left(\mathbf{Y} - \mathbf{X}\boldsymbol{\beta}\right)^\top\left(\mathbf{Y} - \mathbf{X}\boldsymbol{\beta}\right)}{\sigma^2}\right]\right\}\\
&amp;\quad \times \exp\left\{-\frac{1}{2}\left[\frac{\left(\boldsymbol{\beta} - \boldsymbol{\beta}_0\right)^\top\left(\boldsymbol{\beta}_0 - \boldsymbol{\beta}_0\right)}{\sigma_{\beta}^2}\right]\right\}\\
&amp;\propto \exp\left\{-\frac{1}{2}\left[\boldsymbol{\beta}^\top\left(\frac{\mathbf{X}^\top \mathbf{X}}{\sigma^2} + \frac{\mathbf{I}_n}{\sigma_{\beta}^2} \right)\boldsymbol{\beta} - 2\boldsymbol{\beta}^\top\left(\frac{\mathbf{X}^\top\mathbf{Y}}{\sigma^2} + \frac{\boldsymbol{\beta}_0}{\sigma_{\beta}^2}\right)\right]\right\}\\
&amp;\propto \exp\left\{-\frac{1}{2}\left[\boldsymbol{\beta}^\top\mathbf{A}\boldsymbol{\beta} - 2\boldsymbol{\beta}^\top\mathbf{a}\right]\right\}
\end{aligned}\]</span></p>
<p>This is the kernel of a multivariate normal for <span class="math inline">\(\boldsymbol{\beta}\)</span>, with <span class="math inline">\(\mathbf{A} = \boldsymbol{\Sigma}^{-1}\)</span> and <span class="math inline">\(\mathbf{a} = \boldsymbol{\Sigma}^{-1}\boldsymbol{\mu}\)</span>. It’s easy to see then that, <span class="math inline">\(f(\boldsymbol{\beta} | \mathbf{Y}) = N(\mathbf{A}^{-1}\mathbf{a},\mathbf{A}^{-1}).\)</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recall the kernel for the multivariate normal: <span class="math inline">\(\exp\left\{-\frac{1}{2}\left[\mathbf{Y}^\top \boldsymbol{\Sigma}^{-1}\mathbf{Y} - 2\mathbf{Y}^\top \boldsymbol{\Sigma}^{-1} \boldsymbol{\mu}\right]\right\}\)</span>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section id="full-conditional-for-boldsymbolbeta-1" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="full-conditional-for-boldsymbolbeta-1">Full conditional for <span class="math inline">\(\boldsymbol{\beta}\)</span></h2>
<p>The full conditional can be found in closed-form and is Gaussian with the following moments: <span class="math display">\[\begin{aligned}
\mathbb{V}(\boldsymbol{\beta} | \mathbf{Y},\sigma^2) &amp;= \left(\frac{\mathbf{I}_{p+1}}{\sigma_{\beta}^2} + \frac{\mathbf{X}^\top \mathbf{X}}{\sigma^2}\right)^{-1}\\
\mathbb{E}[\boldsymbol{\beta} | \mathbf{Y},\sigma^2] &amp;= \left(\frac{\mathbf{I}_{p+1}}{\sigma_{\beta}^2} + \frac{\mathbf{X}^\top \mathbf{X}}{\sigma^2}\right)^{-1}\left(\frac{\boldsymbol{\beta}_0}{\sigma_{\beta}^2} + \frac{\mathbf{X}^\top \mathbf{Y}}{\sigma^2}\right)
\end{aligned}\]</span></p>
<p>. . .</p>
<ul>
<li><span class="math inline">\(\sigma_{\beta}^2 \rightarrow \infty: \mathbb{E}[\boldsymbol{\beta} | \mathbf{Y},\sigma^2] = (\mathbf{X}^\top \mathbf{X})^{-1}\mathbf{X}^\top \mathbf{Y} = \hat{\boldsymbol{\beta}}_{\text{OLS}} = \hat{\boldsymbol{\beta}}_{\text{MLE}}\)</span></li>
</ul>
<p>. . .</p>
<ul>
<li><span class="math inline">\(\sigma^2 \rightarrow \infty: \mathbb{E}[\boldsymbol{\beta} | \mathbf{Y},\sigma^2] = \boldsymbol{\beta}_0\)</span></li>
</ul>
</section>
<section id="full-conditional-for-sigma2" class="level2">
<h2 class="anchored" data-anchor-id="full-conditional-for-sigma2">Full conditional for <span class="math inline">\(\sigma^2\)</span></h2>
<p>Full conditional for <span class="math inline">\(\sigma^2\)</span>, assuming <span class="math inline">\(f(\sigma^2) \sim IG(a, b)\)</span>:</p>
<p><span class="math display">\[\sigma^2 |  \mathbf{Y} , \boldsymbol{\beta} \sim IG\left(a + \frac{n}{2},b+\frac{\left(\mathbf{Y}-\mathbf{X}\boldsymbol{\beta}\right)^\top\left(\mathbf{Y}-\mathbf{X}\boldsymbol{\beta}\right)}{2}\right)\]</span></p>
<ul>
<li>Why inverse-Gamma (<span class="math inline">\(IG\)</span>) distribution for <span class="math inline">\(\sigma^2\)</span>?</li>
</ul>
</section>
<section id="sampling-from-the-posterior" class="level2">
<h2 class="anchored" data-anchor-id="sampling-from-the-posterior">Sampling from the posterior</h2>
<p>Let’s simulate some data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">###True parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">1.5</span> <span class="co"># true measurement error</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="co"># true beta</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">###Simulation settings</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># number of observations</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">length</span>(beta) <span class="sc">-</span> <span class="dv">1</span> <span class="co"># number of covariates</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">###Simulate data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">54</span>) <span class="co"># set seed</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> p), <span class="at">ncol =</span> p))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sigma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="visualize-simulated-data">Visualize simulated data</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="inspecting-the-prior" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-prior">Inspecting the prior</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">###Define hyperparameters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> p <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sigma_beta <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-5-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="perform-gibbs-sampling" class="level2">
<h2 class="anchored" data-anchor-id="perform-gibbs-sampling">Perform Gibbs sampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>)) <span class="co"># initial value</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Sample from full conditional for beta</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  var_beta <span class="ot">&lt;-</span> <span class="fu">chol2inv</span>(<span class="fu">chol</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">/</span> sigma2 <span class="sc">+</span> <span class="fu">diag</span>(p <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> sigma_beta<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  mean_beta <span class="ot">&lt;-</span> var_beta <span class="sc">%*%</span> (beta0 <span class="sc">/</span> sigma_beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> Y <span class="sc">/</span> sigma2)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rmvnorm</span>(<span class="dv">1</span>, mean_beta, var_beta))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Sample from full conditional for sigma2</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  quadratic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(Y <span class="sc">-</span> X <span class="sc">%*%</span> beta) <span class="sc">%*%</span> (Y <span class="sc">-</span> X <span class="sc">%*%</span> beta))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> a <span class="sc">+</span> n <span class="sc">/</span> <span class="dv">2</span>, <span class="at">rate =</span> b <span class="sc">+</span> quadratic <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Save samples after a burn-in</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">rbind</span>(samples, <span class="fu">c</span>(beta, sigma2))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-results" class="level2">
<h2 class="anchored" data-anchor-id="inspect-results">Inspect results</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-7-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="summary-of-gibbs-sampling" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-gibbs-sampling">Summary of Gibbs sampling</h2>
<ul>
<li><p>Gibbs sampling is great when we are able to sample from the full conditional distributions.</p></li>
<li><p>It has been the main inference machine for Bayesian inference since the early 1990s.</p></li>
<li><p>Computing full conditionals and coding up a Gibbs sampler can be mathematically and computationally rigorous.</p></li>
<li><p>New classes of MCMC are becoming more common to make Bayesian inference less rigorous.</p></li>
</ul>
</section>
</section>
<section id="metropolis-sampling" class="level1">
<h1>Metropolis sampling</h1>
<section id="intuition-behind-metropolis-sampling" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="intuition-behind-metropolis-sampling">Intuition behind Metropolis sampling</h2>
<p>Suppose we have a working collection <span class="math inline">\(\{\boldsymbol{\theta}^{(1)},\ldots,\boldsymbol{\theta}^{(s)}\}\)</span> to which we would like to add a new value <span class="math inline">\(\boldsymbol{\theta}^{(s+1)}\)</span>. Let’s consider adding a value <span class="math inline">\(\boldsymbol{\theta}^*\)</span> which is nearby <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>. Should we include <span class="math inline">\(\boldsymbol{\theta}^*\)</span> in the set or not?</p>
<ul>
<li><p>If <span class="math inline">\(f(\boldsymbol{\theta}^* | \mathbf{Y}) &gt; f(\boldsymbol{\theta}^{(s)} | \mathbf{Y})\)</span> then we want more <span class="math inline">\(\boldsymbol{\theta}^*\)</span>’s in the set than <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>’s.</p>
<ul>
<li>Since <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> is already in the set, then it seems we should include <span class="math inline">\(\boldsymbol{\theta}^*\)</span> as well.</li>
</ul></li>
<li><p>On the other hand, if <span class="math inline">\(f(\boldsymbol{\theta}^* | \mathbf{Y}) &lt; f(\boldsymbol{\theta}^{(s)} | \mathbf{Y})\)</span> then it seems we should not necessarily include <span class="math inline">\(\boldsymbol{\theta}^*\)</span>.</p></li>
<li><p>So, perhaps our decision to include <span class="math inline">\(\boldsymbol{\theta}^*\)</span> or not should be based on a comparison of <span class="math inline">\(f(\boldsymbol{\theta}^* | \mathbf{Y})\)</span> to <span class="math inline">\(f(\boldsymbol{\theta}^{(s)} | \mathbf{Y})\)</span>.</p></li>
</ul>
</section>
<section id="metropolis-acceptance-ratio" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-acceptance-ratio">Metropolis acceptance ratio</h2>
<ul>
<li>Fortunately, the comparison of <span class="math inline">\(f(\boldsymbol{\theta}^* | \mathbf{Y})\)</span> to <span class="math inline">\(f(\boldsymbol{\theta}^{(s)} | \mathbf{Y})\)</span> can be made even if we cannot compute <span class="math inline">\(f(\boldsymbol{\theta} | \mathbf{Y})\)</span>.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
r &amp;= \frac{f(\boldsymbol{\theta}^* | \mathbf{Y})}{f(\boldsymbol{\theta}^{(s)} | \mathbf{Y})}\\
&amp;= \frac{f(\mathbf{Y} | \boldsymbol{\theta}^*)f(\boldsymbol{\theta}^*)}{f(\mathbf{Y})}\frac{f(\mathbf{Y})}{f(\mathbf{Y} | \boldsymbol{\theta}^{(s)})f(\boldsymbol{\theta}^{(s)})}\\
&amp;= \frac{f(\mathbf{Y} | \boldsymbol{\theta}^*)f(\boldsymbol{\theta}^*)}{f(\mathbf{Y} | \boldsymbol{\theta}^{(s)})f(\boldsymbol{\theta}^{(s)})}
\end{aligned}\]</span></p>
<p>Having computed <span class="math inline">\(r\)</span>, how should we proceed?</p>
</section>
<section id="metropolis-intuition" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="metropolis-intuition">Metropolis intuition</h2>
<p>Metropolis ratio: <span class="math inline">\(r = \frac{f(\mathbf{Y} | \boldsymbol{\theta}^*)f(\boldsymbol{\theta}^*)}{f(\mathbf{Y} | \boldsymbol{\theta}^{(s)})f(\boldsymbol{\theta}^{(s)})}\)</span></p>
<p>If <span class="math inline">\(r &gt; 1:\)</span></p>
<ul>
<li><p><em>Intuition:</em> Since <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> is already in our set, we should include <span class="math inline">\(\boldsymbol{\theta}^*\)</span> as it has a higher probability than <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span></p></li>
<li><p><em>Procedure:</em> Accept <span class="math inline">\(\boldsymbol{\theta}^*\)</span> into our set (i.e., set <span class="math inline">\(\boldsymbol{\theta}^{(s + 1)} = \boldsymbol{\theta}^*\)</span>)</p></li>
</ul>
<p>If <span class="math inline">\(r &lt; 1:\)</span></p>
<ul>
<li><p><em>Intuition:</em> The relative frequency of <span class="math inline">\(\boldsymbol{\theta}\)</span>-values in our set equal to <span class="math inline">\(\boldsymbol{\theta}^*\)</span> compared to those equal to <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span> should be <span class="math inline">\(r\)</span>. This means that for every instance of <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>, we should have only a “fraction” of an instance of a <span class="math inline">\(\boldsymbol{\theta}^*\)</span> value.</p></li>
<li><p><em>Procedure:</em> Set <span class="math inline">\(\boldsymbol{\theta}^{(s + 1)}\)</span> equal to either <span class="math inline">\(\boldsymbol{\theta}^*\)</span> or <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>, with probability <span class="math inline">\(r\)</span> and <span class="math inline">\(1 − r\)</span> respectively.</p></li>
</ul>
</section>
<section id="metropolis-update" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-update">Metropolis update</h2>
<p>Given <span class="math inline">\(\boldsymbol{\theta}^{(s)}\)</span>, the Metropolis algorithm generates a value <span class="math inline">\(\boldsymbol{\theta}^{(s + 1)}\)</span> as follows:</p>
<ol type="1">
<li><p>Sample <span class="math inline">\(\boldsymbol{\theta}^*\)</span> from a proposal distribution, <span class="math inline">\(\boldsymbol{\theta}^* ∼ J(\boldsymbol{\theta} | \boldsymbol{\theta}^{(s)})\)</span></p></li>
<li><p>Compute the acceptance ratio <span class="math inline">\(r\)</span></p></li>
<li><p>Let <span class="math display">\[\boldsymbol{\theta}^{(s + 1)} =
\left\{
  \begin{array}{ll}
\boldsymbol{\theta}^* &amp; \text{with probability }\min(r, 1) \\
\boldsymbol{\theta}^{(s)} &amp; \text{with probability }1 -\min(r, 1)
  \end{array}
\right.\]</span></p></li>
</ol>
</section>
<section id="metropolis-proposal-distribution" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-proposal-distribution">Metropolis proposal distribution</h2>
<ul>
<li><p>The proposal distribution is symmetric (i.e., <span class="math inline">\(J(\boldsymbol{\theta}_a | \boldsymbol{\theta}_b) = J(\boldsymbol{\theta}_b | \boldsymbol{\theta}_a)\)</span></p></li>
<li><p>Usually <span class="math inline">\(J(\boldsymbol{\theta} | \boldsymbol{\theta}^{(s)})\)</span> is very simple, with samples from <span class="math inline">\(J(\boldsymbol{\theta} | \boldsymbol{\theta}^{(s)})\)</span> being near <span class="math inline">\(\boldsymbol{\theta}\)</span> with high probability.</p></li>
<li><p>The most common proposal is a normal distribution</p>
<ul>
<li><span class="math inline">\(J(\boldsymbol{\theta} | \boldsymbol{\theta}^{(s)}) = N(\boldsymbol{\theta}^{(s)}, \boldsymbol{\Delta})\)</span></li>
</ul></li>
<li><p>The value of the parameter <span class="math inline">\(\boldsymbol{\Delta}\)</span> is generally chosen to make the approximation algorithm run efficiently</p></li>
</ul>
</section>
<section id="metropolis-and-gibbs-combined" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-and-gibbs-combined">Metropolis and Gibbs combined</h2>
<ul>
<li><p>The Gibbs and Metropolis samplers are actually both algorithms within a larger class of Metropolis-Hastings algorithms</p></li>
<li><p>When performing MCMC, one can actually choose to update a parameter using either a Gibbs or Metropolis update</p></li>
<li><p>Let’s see this in action using our linear regression example</p></li>
</ul>
</section>
<section id="linear-regression-using-metropolisgibbs" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-using-metropolisgibbs">Linear regression using Metropolis/Gibbs</h2>
<ul>
<li><p>In this example, we will use a Metropolis update for <span class="math inline">\(\sigma^2\)</span>, however we will actually focus on <span class="math inline">\(\log\sigma^2\)</span>.</p>
<ul>
<li>Metropolis requires a symmetric proposal, so it is often easier to transform parameters to be on the real line and use a normal proposal.</li>
</ul></li>
<li><p>We will use the following proposal, <span class="math inline">\(\log\sigma^{2*} \sim N\left(\log\sigma^{2(s)}, \delta\right)\)</span>, where <span class="math inline">\(\delta = 1\)</span>.</p></li>
<li><p>We will place the prior: <span class="math inline">\(\log\sigma^2 \sim N(0,1)\)</span>.</p></li>
</ul>
</section>
<section id="linear-regression-using-metropolisgibbs-1" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-using-metropolisgibbs-1">Linear regression using Metropolis/Gibbs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Sample from full conditional for beta</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  var_beta <span class="ot">&lt;-</span> <span class="fu">chol2inv</span>(<span class="fu">chol</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">/</span> sigma2 <span class="sc">+</span> <span class="fu">diag</span>(p <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> sigma_beta<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  mean_beta <span class="ot">&lt;-</span> var_beta <span class="sc">%*%</span> (beta0 <span class="sc">/</span> sigma_beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> Y <span class="sc">/</span> sigma2)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rmvnorm</span>(<span class="dv">1</span>, mean_beta, var_beta))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Metropolis update for sigma2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample a proposal value</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  log_sigma2_proposal <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="fu">log</span>(sigma2), delta)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the ratio r on the log scale for numeric stability</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also, I've decided to update log(sigma2) instead of sigma2, so I can use a normal proposal distribution</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I've placed a normal prior on log(sigma2)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  likelihood_proposal <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dnorm</span>(Y, X <span class="sc">%*%</span> beta, <span class="fu">sqrt</span>(<span class="fu">exp</span>(log_sigma2_proposal)), <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  likelihood_current <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dnorm</span>(Y, X <span class="sc">%*%</span> beta, <span class="fu">sqrt</span>(sigma2), <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  prior_proposal <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(log_sigma2_proposal, <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  prior_current <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(<span class="fu">log</span>(sigma2), <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  log_r <span class="ot">&lt;-</span> (likelihood_proposal <span class="sc">+</span> prior_proposal) <span class="sc">-</span> (likelihood_current <span class="sc">+</span> prior_current)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update beta using Metropolis ratio</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">log</span>(<span class="fu">runif</span>(<span class="dv">1</span>)) <span class="sc">&lt;</span> log_r) sigma2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_sigma2_proposal)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Save samples after a burn-in</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (s <span class="sc">&gt;</span> <span class="dv">5000</span>) samples <span class="ot">&lt;-</span> <span class="fu">rbind</span>(samples, <span class="fu">c</span>(beta, sigma2))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-results-1" class="level2">
<h2 class="anchored" data-anchor-id="inspect-results-1">Inspect results</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-nrow="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-mcmc_files/figure-revealjs/unnamed-chunk-9-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="summary-of-metropolis-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-metropolis-algorithm">Summary of Metropolis algorithm</h2>
<ul>
<li><p>More flexible than Gibbs sampling, because we are no longer required to compute the full conditional distribution analytically.</p></li>
<li><p>Posterior samples can be obtained, however the algorithm must be properly tuned (i.e., choosing <span class="math inline">\(\delta\)</span>) and the samples may take longer to converge.</p></li>
<li><p>Furthermore, choosing a proper proposal distribution can be difficult in practice.</p></li>
<li><p>In more recent years, Hamiltonian Monte Carlo has emerged as an new MCMC approach that alleviates the aforementioned issues.</p></li>
</ul>
</section>
<section id="metropolis-hastings-mh-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-hastings-mh-algorithm">Metropolis-Hastings (MH) algorithm</h2>
<p>The proposal distribution is no longer assumed to be symmetric, so the acceptance ratio is, <span class="math display">\[\begin{aligned}
r &amp;= \frac{f(\mathbf{Y} | \boldsymbol{\beta}^*, \sigma^{2(s)}) f(\boldsymbol{\beta}^*)}{f(\mathbf{Y} | \boldsymbol{\beta}^{(s)},\sigma^{2(s)})f(\boldsymbol{\beta}^{(s)})} \frac{J(\boldsymbol{\beta}^* | \boldsymbol{\beta}^{(s)})}{J(\boldsymbol{\beta}^{(s)} | \boldsymbol{\beta}^*)}.
\end{aligned}\]</span></p>
<p>Both Metropolis and Gibbs can easily be seen as subcases of Metropolis Hastings.</p>
<ul>
<li><p>Metropolis assumes a symmetric proposal, so the proposal terms cancel.</p></li>
<li><p>Gibbs assumes that <span class="math inline">\(J(\boldsymbol{\beta}^{(s)} | \boldsymbol{\beta}^*) = f(\boldsymbol{\beta}^* | \mathbf{Y}, \sigma^{2(s)})\)</span>, which implies that <span class="math inline">\(r=1\)</span>.</p></li>
</ul>
</section>
<section id="hamiltonian-monte-carlo-hmc-intuition" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="hamiltonian-monte-carlo-hmc-intuition">Hamiltonian Monte Carlo (HMC) intuition</h2>
<ul>
<li><p>HMC is a new MCMC approach that has been shown to work better than the usual MH algorithm.</p></li>
<li><p>It is based on the idea of Hamiltonian dynamics (a physical concept)</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rollercoaster Metaphor
</div>
</div>
<div class="callout-body-container callout-body">
<p>Imagine you’re on a roller coaster at an amusement park. As the roller coaster moves along the track, it goes up and down hills. When the roller coaster is at the top of a hill, it has a lot of potential energy (like stored energy). When it goes down the hill, that potential energy turns into kinetic energy (energy of motion), making the roller coaster go faster. Hamiltonian dynamics is like a set of rules that tells us how the roller coaster’s energy changes as it moves along the track.</p>
</div>
</div>
</section>
<section id="hmc-intuition" class="level2">
<h2 class="anchored" data-anchor-id="hmc-intuition">HMC intuition</h2>
<ul>
<li><p>Hamiltonian dynamics is used to generate a proposal from a better proposal distribution, <span class="math inline">\(J(\boldsymbol{\beta}^{(s)} | \boldsymbol{\beta}^*)\)</span>, and modifies the acceptance part so the it has a higher acceptance rate.</p></li>
<li><p>Just like the roller coaster follows the track smoothly, Hamiltonian Monte Carlo (HMC) helps us explore different possibilities smoothly and efficiently. This way, we can make more efficient samples from the posterior, just like how the roller coaster moves quickly and smoothly along its track.</p></li>
<li><p>HMC requires evaluations of <span class="math inline">\(\log f(\boldsymbol{\theta} | \mathbf{Y})\)</span> and <span class="math inline">\(\nabla_{\boldsymbol{\theta}} \log f(\boldsymbol{\theta} | \mathbf{Y})\)</span>,</p></li>
</ul>
<p><span class="math display">\[\log f(\boldsymbol{\theta} | \mathbf{Y}) \propto \log f(\mathbf{Y} | \boldsymbol{\theta}) + \log f(\boldsymbol{\theta})\]</span></p>
</section>
<section id="prepare-for-next-class" class="level2">
<h2 class="anchored" data-anchor-id="prepare-for-next-class">Prepare for next class</h2>
<ul>
<li><p>Begin <a href="https://biostat725-sp25.netlify.app/hw/hw-01">HW 01</a> which is due January 30</p></li>
<li><p>Complete reading to prepare for next Tuesday’s lecture</p></li>
<li><p>Tuesday’s lecture: Probabilistic Programming (Intro to Stan!)</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/biostat725-sp26\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2026, Samuel Berchuck</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/biostat725-sp26/website/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This site is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>