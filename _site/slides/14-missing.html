<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Sam Berchuck">

<title>Missing Data â€“ BIOSTAT 725 - Spring 2026</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Missing Data</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostat725-sp26" title="GitHub organization" class="quarto-navigation-tool px-1" aria-label="GitHub organization"><i class="bi bi-github"></i></a>
    <a href="https://cmgr.oit.duke.edu/containers" title="RStudio Containers" class="quarto-navigation-tool px-1" aria-label="RStudio Containers"><i class="bi bi-code-square"></i></a>
    <a href="https://edstem.org/us/courses/68995/discussion/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-chat-dots-fill"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-check-square-fill"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://canvas.duke.edu/courses/53305">
            Canvas
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.gradescope.com/courses/903622">
            Gradescope
            </a>
          </li>
      </ul>
    </div>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Support</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Useful links</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Computing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../computing-r-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Homework</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 00</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW 05</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../live-coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Live-Coding</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review-of-last-lecture" id="toc-review-of-last-lecture" class="nav-link active" data-scroll-target="#review-of-last-lecture">Review of last lecture</a></li>
  <li><a href="#missing-data-in-research" id="toc-missing-data-in-research" class="nav-link" data-scroll-target="#missing-data-in-research">Missing data in research</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#classifactions-of-missing-data" id="toc-classifactions-of-missing-data" class="nav-link" data-scroll-target="#classifactions-of-missing-data">Classifactions of missing data</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing data</a></li>
  <li><a href="#missing-data-framework" id="toc-missing-data-framework" class="nav-link" data-scroll-target="#missing-data-framework">Missing data framework</a></li>
  <li><a href="#missing-data-notation" id="toc-missing-data-notation" class="nav-link" data-scroll-target="#missing-data-notation">Missing data notation</a></li>
  <li><a href="#complete-data-likelihood" id="toc-complete-data-likelihood" class="nav-link" data-scroll-target="#complete-data-likelihood">Complete data likelihood</a></li>
  <li><a href="#observed-data-likelihood" id="toc-observed-data-likelihood" class="nav-link" data-scroll-target="#observed-data-likelihood">Observed data likelihood</a></li>
  <li><a href="#missing-data-models-mcar" id="toc-missing-data-models-mcar" class="nav-link" data-scroll-target="#missing-data-models-mcar">Missing data models: MCAR</a></li>
  <li><a href="#implications-of-the-missing-model-mcar" id="toc-implications-of-the-missing-model-mcar" class="nav-link" data-scroll-target="#implications-of-the-missing-model-mcar">Implications of the missing model: MCAR</a></li>
  <li><a href="#key-points-about-mcar-assumption" id="toc-key-points-about-mcar-assumption" class="nav-link" data-scroll-target="#key-points-about-mcar-assumption">Key points about MCAR assumption</a></li>
  <li><a href="#missing-data-models-mar" id="toc-missing-data-models-mar" class="nav-link" data-scroll-target="#missing-data-models-mar">Missing data models: MAR</a></li>
  <li><a href="#implications-of-the-missing-model-mar" id="toc-implications-of-the-missing-model-mar" class="nav-link" data-scroll-target="#implications-of-the-missing-model-mar">Implications of the missing model: MAR</a></li>
  <li><a href="#key-points-about-mar-assumption" id="toc-key-points-about-mar-assumption" class="nav-link" data-scroll-target="#key-points-about-mar-assumption">Key points about MAR assumption</a></li>
  <li><a href="#missing-data-models-mnar" id="toc-missing-data-models-mnar" class="nav-link" data-scroll-target="#missing-data-models-mnar">Missing data models: MNAR</a></li>
  <li><a href="#implications-of-the-missing-model-mnar" id="toc-implications-of-the-missing-model-mnar" class="nav-link" data-scroll-target="#implications-of-the-missing-model-mnar">Implications of the missing model: MNAR</a></li>
  <li><a href="#summary-of-missing-mechanisms" id="toc-summary-of-missing-mechanisms" class="nav-link" data-scroll-target="#summary-of-missing-mechanisms">Summary of missing mechanisms</a></li>
  <li><a href="#bayesian-approches-to-missing-data" id="toc-bayesian-approches-to-missing-data" class="nav-link" data-scroll-target="#bayesian-approches-to-missing-data">Bayesian approches to missing data</a>
  <ul class="collapse">
  <li><a href="#lets-motivate-with-some-data" id="toc-lets-motivate-with-some-data" class="nav-link" data-scroll-target="#lets-motivate-with-some-data">Letâ€™s motivate with some data</a></li>
  <li><a href="#simulate-missing-data" id="toc-simulate-missing-data" class="nav-link" data-scroll-target="#simulate-missing-data">Simulate missing data</a></li>
  <li><a href="#visualize-data" id="toc-visualize-data" class="nav-link" data-scroll-target="#visualize-data">Visualize data</a></li>
  <li><a href="#model-fits" id="toc-model-fits" class="nav-link" data-scroll-target="#model-fits">Model fits</a></li>
  <li><a href="#full-bayesian-model" id="toc-full-bayesian-model" class="nav-link" data-scroll-target="#full-bayesian-model">Full Bayesian model</a></li>
  <li><a href="#full-bayesian-model-1" id="toc-full-bayesian-model-1" class="nav-link" data-scroll-target="#full-bayesian-model-1">Full Bayesian model</a></li>
  <li><a href="#full-bayesian-model-for-linear-regression" id="toc-full-bayesian-model-for-linear-regression" class="nav-link" data-scroll-target="#full-bayesian-model-for-linear-regression">Full Bayesian model for linear regression</a></li>
  <li><a href="#full-bayesian-missing-data-model-in-stan" id="toc-full-bayesian-missing-data-model-in-stan" class="nav-link" data-scroll-target="#full-bayesian-missing-data-model-in-stan">Full Bayesian missing data model in Stan</a></li>
  <li><a href="#fit-missing-data-model" id="toc-fit-missing-data-model" class="nav-link" data-scroll-target="#fit-missing-data-model">Fit missing data model</a></li>
  <li><a href="#explore-model-fit" id="toc-explore-model-fit" class="nav-link" data-scroll-target="#explore-model-fit">Explore model fit</a></li>
  <li><a href="#explore-latent-missing-variable" id="toc-explore-latent-missing-variable" class="nav-link" data-scroll-target="#explore-latent-missing-variable">Explore latent missing variable</a></li>
  <li><a href="#summary-of-bayesian-joint-model" id="toc-summary-of-bayesian-joint-model" class="nav-link" data-scroll-target="#summary-of-bayesian-joint-model">Summary of Bayesian joint model</a></li>
  <li><a href="#multiple-imputation" id="toc-multiple-imputation" class="nav-link" data-scroll-target="#multiple-imputation">Multiple imputation</a></li>
  <li><a href="#mice" id="toc-mice" class="nav-link" data-scroll-target="#mice">Mice</a></li>
  <li><a href="#mice-1" id="toc-mice-1" class="nav-link" data-scroll-target="#mice-1">Mice</a></li>
  <li><a href="#model-for-the-imputed-datasets" id="toc-model-for-the-imputed-datasets" class="nav-link" data-scroll-target="#model-for-the-imputed-datasets">Model for the imputed datasets</a></li>
  <li><a href="#fit-the-model-to-the-imputed-data" id="toc-fit-the-model-to-the-imputed-data" class="nav-link" data-scroll-target="#fit-the-model-to-the-imputed-data">Fit the model to the imputed data</a></li>
  <li><a href="#inspect-traceplots" id="toc-inspect-traceplots" class="nav-link" data-scroll-target="#inspect-traceplots">Inspect traceplots</a></li>
  <li><a href="#inspect-traceplots-1" id="toc-inspect-traceplots-1" class="nav-link" data-scroll-target="#inspect-traceplots-1">Inspect traceplots</a></li>
  <li><a href="#inspect-traceplots-2" id="toc-inspect-traceplots-2" class="nav-link" data-scroll-target="#inspect-traceplots-2">Inspect traceplots</a></li>
  <li><a href="#inspect-traceplots-3" id="toc-inspect-traceplots-3" class="nav-link" data-scroll-target="#inspect-traceplots-3">Inspect traceplots</a></li>
  <li><a href="#inspect-traceplots-4" id="toc-inspect-traceplots-4" class="nav-link" data-scroll-target="#inspect-traceplots-4">Inspect traceplots</a></li>
  <li><a href="#comparison-of-methods-alpha" id="toc-comparison-of-methods-alpha" class="nav-link" data-scroll-target="#comparison-of-methods-alpha">Comparison of methods: <span class="math inline">\(\alpha\)</span></a></li>
  <li><a href="#comparison-of-methods-beta_1" id="toc-comparison-of-methods-beta_1" class="nav-link" data-scroll-target="#comparison-of-methods-beta_1">Comparison of methods: <span class="math inline">\(\beta_1\)</span></a></li>
  <li><a href="#comparison-of-methods-beta_2" id="toc-comparison-of-methods-beta_2" class="nav-link" data-scroll-target="#comparison-of-methods-beta_2">Comparison of methods: <span class="math inline">\(\beta_2\)</span></a></li>
  <li><a href="#comparison-of-methods-beta_3" id="toc-comparison-of-methods-beta_3" class="nav-link" data-scroll-target="#comparison-of-methods-beta_3">Comparison of methods: <span class="math inline">\(\beta_3\)</span></a></li>
  <li><a href="#comparison-of-methods-sigma" id="toc-comparison-of-methods-sigma" class="nav-link" data-scroll-target="#comparison-of-methods-sigma">Comparison of methods: <span class="math inline">\(\sigma\)</span></a></li>
  <li><a href="#prepare-for-next-class" id="toc-prepare-for-next-class" class="nav-link" data-scroll-target="#prepare-for-next-class">Prepare for next class</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/biostat725-sp26/website/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="14-missing.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Missing Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Sam Berchuck </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Feb 25, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="review-of-last-lecture" class="level2">
<h2 class="anchored" data-anchor-id="review-of-last-lecture">Review of last lecture</h2>
<ul>
<li>Last, we learned about classification for binary and multiclass problems.</li>
</ul>
</section>
<section id="missing-data-in-research" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-in-research">Missing data in research</h2>
<ul>
<li><p>In any real-world dataset, missing values are nearly always going to be present.</p>
<ul>
<li>Missing data can be totally innocuous or a source of bias.</li>
</ul></li>
<li><p>Cannot determine which because there are no values to inspect.</p></li>
<li><p>Handling missing data is extremely difficult!</p></li>
</ul>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<ul>
<li><p>Suppose an individualâ€™s depression scores are missing in dataset of patients with colon cancer.</p></li>
<li><p>It could be missing because:</p>
<ul>
<li><p>A data entry error where some values did not make it into the dataset.</p></li>
<li><p>The patient is a man, and men are less likely to complete the depression score in general (i.e., it is not related to the unobserved depression).</p></li>
<li><p>The patient has depression and as a result did not complete the depression survey.</p></li>
</ul></li>
</ul>
</section>
<section id="classifactions-of-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="classifactions-of-missing-data">Classifactions of missing data</h2>
<ul>
<li><p>Missing completely at random (MCAR)</p>
<ul>
<li>This is the ideal case but rarely seen in practice. Usually a data entry problem.</li>
</ul></li>
<li><p>Missing at random (MAR)</p>
<ul>
<li>The missing value is related to some other variable that has been collected.</li>
</ul></li>
<li><p>Missing not at random (MNAR)</p>
<ul>
<li>The missing value is related to a variable that was not collected or not observed.</li>
</ul></li>
</ul>
</section>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">Missing data</h2>
<ul>
<li><p>Missing data can appear in the outcome and/or predictors.</p></li>
<li><p>Today, we will write down some math for missing data occuring in the outcome space, however this is generalizable to missingness in the predictor space.</p></li>
</ul>
</section>
<section id="missing-data-framework" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="missing-data-framework">Missing data framework</h2>
<ul>
<li><p>We are interested in modeling a random variable <span class="math inline">\(Y_{i}\)</span>, for <span class="math inline">\(i \in \{1,\ldots,n\}\)</span>.</p></li>
<li><p>In a missing data setting, we only observe the outcome in subset of observations, <span class="math inline">\(\mathbf{Y}_{obs} = \{Y_{i}:i \in \mathcal N_{obs}\}\)</span>.</p>
<ul>
<li><span class="math inline">\(\mathcal N_{obs}\)</span> is the set of indeces in the observed set, such that <span class="math inline">\(|\mathcal N_{obs}|= n_{obs}\)</span> is the number of observed data points.</li>
</ul></li>
<li><p>The remaining observations are assumed to be missing and are contained in <span class="math inline">\(\mathbf{Y}_{mis} = \{Y_{i}:i \in \mathcal N_{mis}\}\)</span>.</p>
<ul>
<li><span class="math inline">\(\mathcal N_{mis}\)</span> is the set of indeces of the missing data and <span class="math inline">\(|\mathcal N_{mis}|= n_{mis}\)</span> is the number of missing data points.</li>
</ul></li>
<li><p>The full set of data is given by <span class="math inline">\(\mathbf{Y}=(\mathbf{Y}_{obs},\mathbf{Y}_{mis})\)</span>.</p></li>
</ul>
</section>
<section id="missing-data-notation" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-notation">Missing data notation</h2>
<ul>
<li><p>Define <span class="math inline">\(O_{i}\)</span> as a binary indicator of observation <span class="math inline">\(Y_{i}\)</span> being present, where <span class="math inline">\(O_{i} = 1\)</span> indicates that <span class="math inline">\(Y_{i}\)</span> was observed.</p></li>
<li><p>The collection of missingness indicators is given by <span class="math inline">\(\mathbf{O} = \{O_{i}:i = 1,\ldots,n\}\)</span>.</p></li>
<li><p>Our observed data then consists of <span class="math inline">\((\mathbf{Y}_{obs}, \mathbf{O})\)</span>.</p></li>
</ul>
</section>
<section id="complete-data-likelihood" class="level2">
<h2 class="anchored" data-anchor-id="complete-data-likelihood">Complete data likelihood</h2>
<ul>
<li>The joint distribution of <span class="math inline">\((\mathbf{Y}, \mathbf{O})\)</span> can be written as,</li>
</ul>
<p><span class="math display">\[f(\mathbf{Y}, \mathbf{O} | \mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) = \underbrace{f(\mathbf{Y} | \mathbf{X}, \boldsymbol{\theta})}_{\text{likelihood}} \times  \underbrace{f(\mathbf{O} | \mathbf{Y}, \mathbf{X}, \boldsymbol{\phi})}_{\text{missing model}}.\]</span></p>
<ul>
<li><p>The parameter block, <span class="math inline">\((\boldsymbol{\theta},\boldsymbol{\phi})\)</span>, consists of:</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{\theta}\)</span>, the <strong>target parameters</strong> of interest (e.g., feature effects on outcome), and</p></li>
<li><p><span class="math inline">\(\boldsymbol{\phi}\)</span>, the <strong>nuisance parameters</strong>.</p></li>
</ul></li>
</ul>
<p>. . .</p>
<p><strong>Can we perform inference using this likelihood?</strong></p>
</section>
<section id="observed-data-likelihood" class="level2">
<h2 class="anchored" data-anchor-id="observed-data-likelihood">Observed data likelihood</h2>
<ul>
<li>The likelihood for the observed data must be written by marginalizing over the unobserved outcome variables.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
f(\mathbf{Y}_{obs}, \mathbf{O} | \mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) &amp;= \int f(\mathbf{Y}_{obs}, \mathbf{Y}_{mis}, \mathbf{O} | \mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;= \int f(\mathbf{Y}, \mathbf{O} |\mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;= \int \underbrace{f(\mathbf{Y} |\mathbf{X}, \boldsymbol{\theta}) f(\mathbf{O} | \mathbf{X},\mathbf{Y}, \boldsymbol{\phi})}_{\text{complete data likelihood}} d\mathbf{Y}_{mis}
\end{aligned}\]</span></p>
</section>
<section id="missing-data-models-mcar" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-models-mcar">Missing data models: MCAR</h2>
<p>The data are missing completely at random (MCAR) if the missing mechanism is defined as, <span class="math display">\[\begin{aligned}
f(\mathbf{O} | \mathbf{Y},\mathbf{X},\boldsymbol{\phi}) &amp;= f(\mathbf{O} | \mathbf{Y}_{obs}, \mathbf{Y}_{mis},\mathbf{X},\boldsymbol{\phi})\\
&amp;= f(\mathbf{O} | \boldsymbol{\phi}).
\end{aligned}\]</span></p>
<ul>
<li>The missingness does not depend on any data.</li>
</ul>
</section>
<section id="implications-of-the-missing-model-mcar" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="implications-of-the-missing-model-mcar">Implications of the missing model: MCAR</h2>
<p><span class="math display">\[\begin{aligned}
f(\mathbf{Y}_{obs}, \mathbf{O} |\mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) &amp;= \int f(\mathbf{Y} | \mathbf{X},\boldsymbol{\theta}) f(\mathbf{O} | \mathbf{Y}, \mathbf{X},\boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;= \int f(\mathbf{Y} | \mathbf{X},\boldsymbol{\theta}) f(\mathbf{O} | \boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;=  f(\mathbf{O} | \boldsymbol{\phi}) \int f(\mathbf{Y}_{obs} |\mathbf{X}_{obs}, \boldsymbol{\theta}) f(\mathbf{Y}_{mis} |\mathbf{X}_{mis}, \boldsymbol{\theta})d\mathbf{Y}_{mis}\\
&amp;=  f(\mathbf{Y}_{obs} | \mathbf{X}_{obs},\boldsymbol{\theta})f(\mathbf{O} | \boldsymbol{\phi})\int  f(\mathbf{Y}_{mis} |\mathbf{X}_{mis}, \boldsymbol{\theta}) d\mathbf{Y}_{mis}\\
&amp;=  f(\mathbf{Y}_{obs} | \mathbf{X}_{obs},\boldsymbol{\theta})f(\mathbf{O} | \boldsymbol{\phi}).
\end{aligned}\]</span></p>
</section>
<section id="key-points-about-mcar-assumption" class="level2">
<h2 class="anchored" data-anchor-id="key-points-about-mcar-assumption">Key points about MCAR assumption</h2>
<ul>
<li><p><strong>No bias:</strong> The analysis based on the observed data will not be biased, as the missingness does not systematically favor any particular pattern in the data.</p></li>
<li><p><strong>Reduced power:</strong> While unbiased, MCAR still reduces the statistical power of the analysis due to the smaller sample size resulting from missing data.</p></li>
<li><p><strong>Simple handling methods:</strong> Because of its random nature, MCAR allows for straightforward handling methods like <strong><em>listwise deletion</em></strong> (i.e., complete-case analysis) or simple imputation techniques (e.g., mean imputation) without introducing bias.</p></li>
</ul>
</section>
<section id="missing-data-models-mar" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-models-mar">Missing data models: MAR</h2>
<p>The data are missing at random (MAR) if the missing mechanism is defined as, <span class="math display">\[\begin{aligned}
f(\mathbf{O} | \mathbf{Y},\mathbf{X},\boldsymbol{\phi}) &amp;= f(\mathbf{O} | \mathbf{Y}_{obs}, \mathbf{Y}_{mis},\mathbf{X},\boldsymbol{\phi})\\
&amp;= f(\mathbf{O} | \mathbf{Y}_{obs},\mathbf{X},\boldsymbol{\phi}).
\end{aligned}\]</span></p>
<ul>
<li>The missingness depends on the observed data only.</li>
</ul>
</section>
<section id="implications-of-the-missing-model-mar" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="implications-of-the-missing-model-mar">Implications of the missing model: MAR</h2>
<p><span class="math display">\[\begin{aligned}
f(\mathbf{Y}_{obs}, \mathbf{O} |\mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi}) &amp;= \int f(\mathbf{Y} |\mathbf{X}, \boldsymbol{\theta}) f(\mathbf{O} | \mathbf{Y},\mathbf{X}, \boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}= \int f(\mathbf{Y} | \mathbf{X},\boldsymbol{\theta}) f(\mathbf{O} | \mathbf{Y}_{obs},\mathbf{X}, \boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}=  f(\mathbf{O} | \mathbf{Y}_{obs},\mathbf{X},\boldsymbol{\phi}) \int f(\mathbf{Y}_{obs} | \mathbf{X}_{obs},\boldsymbol{\theta}) f(\mathbf{Y}_{mis} | \mathbf{X}_{mis},\boldsymbol{\theta})d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}=  f(\mathbf{Y}_{obs} |\mathbf{X}_{obs}, \boldsymbol{\theta})f(\mathbf{O} |\mathbf{Y}_{obs},\mathbf{X}, \boldsymbol{\phi})\int  f(\mathbf{Y}_{mis} | \mathbf{X}_{mis},\boldsymbol{\theta}) d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}=  f(\mathbf{Y}_{obs} | \mathbf{X}_{obs},\boldsymbol{\theta})f(\mathbf{O} |\mathbf{Y}_{obs}, \mathbf{X},\boldsymbol{\phi}).
\end{aligned}\]</span></p>
<ul>
<li><strong>Unbiased Parameter Estimates:</strong> Similar to MCAR, we can perform a complete case analysis and can ignore the missing data model! This is never done, however, because it leads to incorrect inference.</li>
</ul>
</section>
<section id="key-points-about-mar-assumption" class="level2">
<h2 class="anchored" data-anchor-id="key-points-about-mar-assumption">Key points about MAR assumption</h2>
<ul>
<li><p><strong>Complete-case analysis is not acceptable:</strong></p>
<ul>
<li><p>Parameter estimation remains unbiased, but, in general, estimation of variances and intervals is biased.</p></li>
<li><p>Also, smaller sample size leads to less power and worse prediction.</p></li>
<li><p>Under certain missingness settings, parameter estimation may not be unbiased.</p></li>
</ul></li>
<li><p><strong>Simple handling approaches fail:</strong> Methods like mean imputation will also result in small estimated standard errors.</p></li>
<li><p><strong>More advanced methods are needed:</strong> Multiple imputation, Bayes.</p></li>
</ul>
</section>
<section id="missing-data-models-mnar" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-models-mnar">Missing data models: MNAR</h2>
<p>The data are missing not at random (MNAR) if the missing mechanism is defined as, <span class="math display">\[\begin{aligned}
f(\mathbf{O} | \mathbf{Y},\mathbf{X},\boldsymbol{\phi}) &amp;= f(\mathbf{O} | \mathbf{Y}_{obs}, \mathbf{Y}_{mis},\mathbf{X},\boldsymbol{\phi}).
\end{aligned}\]</span></p>
<ul>
<li>The missingness depends on the observed and missing data.</li>
</ul>
</section>
<section id="implications-of-the-missing-model-mnar" class="level2 midi">
<h2 class="midi anchored" data-anchor-id="implications-of-the-missing-model-mnar">Implications of the missing model: MNAR</h2>
<p><span class="math display">\[\begin{aligned}
f(\mathbf{Y}_{obs}, \mathbf{O} | \mathbf{X},\boldsymbol{\theta},\boldsymbol{\phi}) &amp;= \int f(\mathbf{Y} | \mathbf{X},\boldsymbol{\theta}) f(\mathbf{O} | \mathbf{Y},\mathbf{X}, \boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}= \int f(\mathbf{Y} | \mathbf{X},\boldsymbol{\theta}) f(\mathbf{O} | \mathbf{Y}_{obs},\mathbf{Y}_{mis}, \mathbf{X},\boldsymbol{\phi}) d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}= \int f(\mathbf{Y}_{obs} |\mathbf{X}_{obs}, \boldsymbol{\theta}) f(\mathbf{Y}_{mis} | \mathbf{X}_{mis},\boldsymbol{\theta})f(\mathbf{O} | \mathbf{Y},\mathbf{X},\boldsymbol{\phi})d\mathbf{Y}_{mis}\\
&amp;\hspace{-2in}= f(\mathbf{Y}_{obs} | \mathbf{X}_{obs},\boldsymbol{\theta}) \int f(\mathbf{Y}_{mis} | \mathbf{X}_{mis},\boldsymbol{\theta})f(\mathbf{O} | \mathbf{Y},\mathbf{X},\boldsymbol{\phi})d\mathbf{Y}_{mis}
\end{aligned}\]</span></p>
<ul>
<li><p>Under the MNAR assumption, we are NOT allowed to ignore the missing data. We must specify a model for the missing data.</p></li>
<li><p>This is really hard! We can ignore this in our class.</p></li>
</ul>
</section>
<section id="summary-of-missing-mechanisms" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-missing-mechanisms">Summary of missing mechanisms</h2>
<ul>
<li><p>Under MCAR and MAR, we are allowed to fit our model to the observed data (i.e., a complete case analysis/listwise deletion). Under these settings the missingness is considered <strong>ignorable</strong>.</p></li>
<li><p>Under MAR, fitting the complete case analysis is not efficient and advanced techniques are needed to guarentee proper statistical inference.</p></li>
<li><p>Under MNAR, we must model the missing data mechanism. This data is considered <strong>non-ignorable</strong>.</p></li>
</ul>
</section>
<section id="bayesian-approches-to-missing-data" class="level1">
<h1>Bayesian approches to missing data</h1>
<ul>
<li>Full Bayesian joint model</li>
<li>Multiple imputation</li>
</ul>
<section id="lets-motivate-with-some-data" class="level2">
<h2 class="anchored" data-anchor-id="lets-motivate-with-some-data">Letâ€™s motivate with some data</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="simulate-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="simulate-missing-data">Simulate missing data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">54</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fulldata)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>fulldata<span class="sc">$</span>o <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">expit</span>(<span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">scale</span>(fulldata<span class="sc">$</span>x1) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> fulldata<span class="sc">$</span>x2))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fulldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     y    x1 x2  Sex o
1 65.6 174.0  1 Male 1
2 71.8 175.3  1 Male 0
3 80.7 193.5  1 Male 0
4 72.6 186.5  1 Male 0
5 78.8 187.2  1 Male 0
6 74.8 181.5  1 Male 0</code></pre>
</div>
</div>
</section>
<section id="visualize-data" class="level2">
<h2 class="anchored" data-anchor-id="visualize-data">Visualize data</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="model-fits" class="level2">
<h2 class="anchored" data-anchor-id="model-fits">Model fits</h2>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-6-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="full-bayesian-model" class="level2">
<h2 class="anchored" data-anchor-id="full-bayesian-model">Full Bayesian model</h2>
<ul>
<li>Since we are Bayesians, we can treat the unobserved <span class="math inline">\(\mathbf{Y}_{mis}\)</span> as parameters and work with the complete data likelihood.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
f(\boldsymbol{\theta}, \boldsymbol{\phi}, \mathbf{Y}_{mis} | \mathbf{Y}_{obs},\mathbf{O},\mathbf{X}) &amp;\propto f(\mathbf{Y}, \mathbf{O}, \boldsymbol{\theta}, \boldsymbol{\phi} | \mathbf{X})\\
&amp;\hspace{-4in}=f(\mathbf{Y}, \mathbf{O} | \mathbf{X}, \boldsymbol{\theta},\boldsymbol{\phi})f(\boldsymbol{\theta},\boldsymbol{\phi})\\
&amp;\hspace{-4in}= f(\mathbf{Y} | \mathbf{X}, \boldsymbol{\theta})f(\mathbf{O} | \mathbf{Y}, \mathbf{X}, \boldsymbol{\phi})f(\boldsymbol{\theta},\boldsymbol{\phi})\\
&amp;\hspace{-4in}=f(\mathbf{Y}_{obs} | \mathbf{X}_{obs}, \boldsymbol{\theta})f(\mathbf{Y}_{mis} | \mathbf{X}_{mis}, \boldsymbol{\theta})f(\mathbf{O} | \mathbf{Y}, \mathbf{X}, \boldsymbol{\phi})f(\boldsymbol{\theta},\boldsymbol{\phi})\\
\end{aligned}\]</span></p>
<ul>
<li>We can simplify this posterior by dropping the missing data mechanism.</li>
</ul>
</section>
<section id="full-bayesian-model-1" class="level2">
<h2 class="anchored" data-anchor-id="full-bayesian-model-1">Full Bayesian model</h2>
<ul>
<li>Assuming that <span class="math inline">\(f(\boldsymbol{\theta},\boldsymbol{\phi}) = f(\boldsymbol{\theta})f(\boldsymbol{\phi})\)</span>, the missingness process does not need to be explicitly modeled when we are interested in inference for <span class="math inline">\(\boldsymbol{\theta}\)</span>.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
&amp;f(\boldsymbol{\theta}, \mathbf{Y}_{mis} | \mathbf{Y}_{obs},\mathbf{O},\mathbf{X})\\ &amp;\hspace{2in}\propto f(\mathbf{Y}_{obs} | \mathbf{X}_{obs}, \boldsymbol{\theta})f(\mathbf{Y}_{mis} | \mathbf{X}_{mis}, \boldsymbol{\theta})f(\boldsymbol{\theta})
\end{aligned}\]</span></p>
</section>
<section id="full-bayesian-model-for-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="full-bayesian-model-for-linear-regression">Full Bayesian model for linear regression</h2>
<p><span class="math display">\[\begin{aligned}
Y_i | \alpha, \beta, \sigma^2 &amp;\stackrel{ind}{\sim} N(\alpha + \mathbf{x}_i\boldsymbol{\beta}, \sigma^2), \quad i \in \mathcal N_{obs}\\
Y_i | \alpha, \beta, \sigma^2&amp;\stackrel{ind}{\sim} N(\alpha + \mathbf{x}_i \boldsymbol{\beta}, \sigma^2), \quad i \in \mathcal N_{mis}\\
\alpha &amp;\sim f(\alpha)\\
\beta &amp;\sim f(\boldsymbol{\beta})\\
\sigma &amp;\sim f(\sigma),
\end{aligned}\]</span></p>
<ul>
<li><span class="math inline">\(\mathbf{x}_i = (height_i, 1(sex_i = male), height_i \times 1(sex_i = male))\)</span>.</li>
</ul>
</section>
<section id="full-bayesian-missing-data-model-in-stan" class="level2">
<h2 class="anchored" data-anchor-id="full-bayesian-missing-data-model-in-stan">Full Bayesian missing data model in Stan</h2>
<div class="cell" data-output.var="missing">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// saved in missing-full-bayes.stan</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; n_obs;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; n_mis;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; p;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_obs] Y_obs;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n_obs, p] X_obs;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n_mis, p] X_mis;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_obs] Y_obs_centered;</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> Y_bar;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n_obs, p] X_obs_centered;</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n_mis, p] X_mis_centered;</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">row_vector</span>[p] X_bar;</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  Y_bar = mean(Y_obs);</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  Y_obs_centered = Y_obs - Y_bar;</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n_obs + n_mis, p] X = append_row(X_obs, X_mis);</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:p) {</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    X_bar[i] = mean(X[, i]);</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    X_obs_centered[, i] = X_obs[, i] - X_bar[i];</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    X_mis_centered[, i] = X_mis[, i] - X_bar[i];</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha_centered;</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[p] beta;</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; sigma;</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_mis] Y_mis_centered;</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(Y_obs_centered | alpha_centered + X_obs_centered * beta, sigma);</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(Y_mis_centered | alpha_centered + X_mis_centered * beta, sigma);</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(alpha_centered | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(beta | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(sigma | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha;</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n_mis] Y_mis;</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  alpha = Y_bar + alpha_centered - X_bar * beta;</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  Y_mis = Y_mis_centered + Y_bar;</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-missing-data-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-missing-data-model">Fit missing data model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>stan_missing_data_model <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">file =</span> <span class="st">"missing-full-bayes.stan"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x1 <span class="sc">*</span> x2, <span class="at">data =</span> fulldata)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>stan_data_missing_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_obs =</span> <span class="fu">sum</span>(fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_mis =</span> <span class="fu">sum</span>(fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fu">ncol</span>(X),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y_obs =</span> <span class="fu">array</span>(fulldata<span class="sc">$</span>y[fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_obs =</span> X[fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_mis =</span> X[fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>fit_full_bayes_joint <span class="ot">&lt;-</span> <span class="fu">sampling</span>(stan_missing_data_model, stan_data_missing_data)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_full_bayes_joint, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma"</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-model-fit" class="level2">
<h2 class="anchored" data-anchor-id="explore-model-fit">Explore model fit</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit_full_bayes_joint, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma"</span>), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

          mean se_mean    sd   2.5% 97.5% n_eff Rhat
alpha   -48.38    0.83 21.10 -90.15 -7.03   653 1.00
beta[1]   0.65    0.00  0.12   0.41  0.90   673 1.00
beta[2]  -3.19    0.22  9.75 -22.23 16.56  2047 1.00
beta[3]   0.08    0.00  0.06  -0.03  0.19  2487 1.00
sigma     8.21    0.02  0.58   7.17  9.45   600 1.01

Samples were drawn using NUTS(diag_e) at Wed Jan 22 19:43:45 2025.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
</section>
<section id="explore-latent-missing-variable" class="level2">
<h2 class="anchored" data-anchor-id="explore-latent-missing-variable">Explore latent missing variable</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Y_mis <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit_full_bayes_joint, <span class="at">pars =</span> <span class="st">"Y_mis"</span>)<span class="sc">$</span>Y_mis</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Y_mis) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Y_mis["</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Y_mis), <span class="st">"]"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas_ridges</span>(Y_mis[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-missing_files/figure-revealjs/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary-of-bayesian-joint-model" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-bayesian-joint-model">Summary of Bayesian joint model</h2>
<ul>
<li><p>The joint model treats the missing data as parameters (i.e., latent variables in the model).</p></li>
<li><p>Placing a prior on the missing data allows us to jointly learn the model parameters and the missing data.</p></li>
<li><p>Equivalent to multiple imputation at every step of the HMC. Can be slow!</p></li>
<li><p>In Stan, we can only treat continuous missing data as parameters, so this method is somewhat limited (what do we do if the missing data is a binary outcome?)</p></li>
</ul>
</section>
<section id="multiple-imputation" class="level2">
<h2 class="anchored" data-anchor-id="multiple-imputation">Multiple imputation</h2>
<ul>
<li><p>As an alternative to fitting a joint model, there are many approaches that allow us to impute missing data before the actual model fitting takes place.</p></li>
<li><p>Each missing value is not imputed once but <span class="math inline">\(m\)</span> times leading to a total of <span class="math inline">\(m\)</span> fully imputed data sets.</p></li>
<li><p>The model can then be fitted to each of those data sets separately and results are pooled across models, afterwards.</p></li>
<li><p>One widely applied package for multiple imputation is <code>mice</code> (Buuren &amp; Groothuis-Oudshoorn, 2010) and we will use it in combination with Stan.</p></li>
</ul>
</section>
<section id="mice" class="level2">
<h2 class="anchored" data-anchor-id="mice">Mice</h2>
<ul>
<li>Here, we apply the default settings of mice, which means that all variables will be used to impute missing values in all other variables and imputation functions automatically chosen based on the variablesâ€™ characteristics.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>mardata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> fulldata<span class="sc">$</span>y,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> fulldata<span class="sc">$</span>x1,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> fulldata<span class="sc">$</span>x2</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>mardata<span class="sc">$</span>y[fulldata<span class="sc">$</span>o <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(mardata, <span class="at">m =</span> m, <span class="at">print =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mice-1" class="level2">
<h2 class="anchored" data-anchor-id="mice-1">Mice</h2>
<ul>
<li><p>Now, we have <span class="math inline">\(m = 5\)</span> imputed data sets stored within the <code>imp</code> object.</p>
<ul>
<li>In practice, we will likely need more than 5 of those to accurately account for the uncertainty induced by the missingness, perhaps even in the area of 100 imputed data sets (Zhou &amp; Reiter, 2010).</li>
</ul></li>
<li><p>We can extract the first imputed dataset.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can now fit our model <span class="math inline">\(m\)</span> times for each imputed data sets and combine the posterior samples from all chains for inference.</li>
</ul>
</section>
<section id="model-for-the-imputed-datasets" class="level2">
<h2 class="anchored" data-anchor-id="model-for-the-imputed-datasets">Model for the imputed datasets</h2>
<div class="cell" data-output.var="cc">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// bayesian-mi.stan</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; n;</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">1</span>&gt; p;</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n] Y;</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n, p] X;</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[n] Y_centered;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> Y_bar;</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[n, p] X_centered;</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">row_vector</span>[p] X_bar;</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  Y_bar = mean(Y);</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  Y_centered = Y - Y_bar;</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:p) {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    X_bar[i] = mean(X[, i]);</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    X_centered[, i] = X[, i] - X_bar[i];</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha_centered;</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[p] beta;</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; sigma;</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(Y_centered | alpha_centered + X_centered * beta, sigma);</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(alpha_centered | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(beta | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target +=</span> normal_lpdf(sigma | <span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha;</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  alpha = Y_bar + alpha_centered - X_bar * beta;</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-the-model-to-the-imputed-data" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model-to-the-imputed-data">Fit the model to the imputed data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stan_bayesian_mi <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">file =</span> <span class="st">"bayesian-mi.stan"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> beta <span class="ot">&lt;-</span> sigma <span class="ot">&lt;-</span> r_hat <span class="ot">&lt;-</span> n_eff <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>n_chains <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Load each imputed dataset and fit the Stan complete case model</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp, i)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> x1 <span class="sc">*</span> x2, <span class="at">data =</span> data)[, <span class="sc">-</span><span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  stan_data_bayesian_mi <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">nrow</span>(data),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">ncol</span>(X),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> data<span class="sc">$</span>y,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> X</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  fit_mi <span class="ot">&lt;-</span> <span class="fu">sampling</span>(stan_bayesian_mi, stan_data_bayesian_mi, <span class="at">chains =</span> n_chains)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">###Save convergence diagnostics from each imputed dataset</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  r_hat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(r_hat, <span class="fu">summary</span>(fit_mi)<span class="sc">$</span>summary[, <span class="st">"Rhat"</span>])</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  n_eff <span class="ot">&lt;-</span> <span class="fu">cbind</span>(n_eff, <span class="fu">summary</span>(fit_mi)<span class="sc">$</span>summary[, <span class="st">"n_eff"</span>])</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  pars <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(fit_mi, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma"</span>))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Save the parameters from each imputed dataset</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  n_sims_chain <span class="ot">&lt;-</span> <span class="fu">length</span>(pars<span class="sc">$</span>alpha) <span class="sc">/</span> n_chains</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rbind</span>(alpha, <span class="fu">cbind</span>(i, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_chains, <span class="at">each =</span> n_sims_chain), pars<span class="sc">$</span>alpha))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">rbind</span>(beta, <span class="fu">cbind</span>(i, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_chains, <span class="at">each =</span> n_sims_chain), pars<span class="sc">$</span>beta))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sigma, <span class="fu">cbind</span>(i, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_chains, <span class="at">each =</span> n_sims_chain), pars<span class="sc">$</span>sigma))</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-traceplots" class="level2">
<h2 class="anchored" data-anchor-id="inspect-traceplots">Inspect traceplots</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/14/alpha.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
</section>
<section id="inspect-traceplots-1" class="level2">
<h2 class="anchored" data-anchor-id="inspect-traceplots-1">Inspect traceplots</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/14/beta[1].png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
</section>
<section id="inspect-traceplots-2" class="level2">
<h2 class="anchored" data-anchor-id="inspect-traceplots-2">Inspect traceplots</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/14/beta[2].png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
</section>
<section id="inspect-traceplots-3" class="level2">
<h2 class="anchored" data-anchor-id="inspect-traceplots-3">Inspect traceplots</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/14/beta[3].png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
</section>
<section id="inspect-traceplots-4" class="level2">
<h2 class="anchored" data-anchor-id="inspect-traceplots-4">Inspect traceplots</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/14/sigma.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
</section>
<section id="comparison-of-methods-alpha" class="level2 small">
<h2 class="small anchored" data-anchor-id="comparison-of-methods-alpha">Comparison of methods: <span class="math inline">\(\alpha\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
<th style="text-align: right;">n_eff</th>
<th style="text-align: right;">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">-43.82</td>
<td style="text-align: right;">13.78</td>
<td style="text-align: right;">-70.89</td>
<td style="text-align: right;">-16.75</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes Joint</td>
<td style="text-align: right;">-48.38</td>
<td style="text-align: right;">21.10</td>
<td style="text-align: right;">-90.15</td>
<td style="text-align: right;">-7.03</td>
<td style="text-align: right;">652.73</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes MI</td>
<td style="text-align: right;">-43.45</td>
<td style="text-align: right;">23.72</td>
<td style="text-align: right;">-85.03</td>
<td style="text-align: right;">3.97</td>
<td style="text-align: right;">119974.91</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">-30.56</td>
<td style="text-align: right;">23.70</td>
<td style="text-align: right;">-77.55</td>
<td style="text-align: right;">16.43</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comparison-of-methods-beta_1" class="level2 small">
<h2 class="small anchored" data-anchor-id="comparison-of-methods-beta_1">Comparison of methods: <span class="math inline">\(\beta_1\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
<th style="text-align: right;">n_eff</th>
<th style="text-align: right;">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes Joint</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">672.77</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes MI</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">119778.47</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comparison-of-methods-beta_2" class="level2 small">
<h2 class="small anchored" data-anchor-id="comparison-of-methods-beta_2">Comparison of methods: <span class="math inline">\(\beta_2\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
<th style="text-align: right;">n_eff</th>
<th style="text-align: right;">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">-17.13</td>
<td style="text-align: right;">19.56</td>
<td style="text-align: right;">-55.57</td>
<td style="text-align: right;">21.30</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes Joint</td>
<td style="text-align: right;">-3.19</td>
<td style="text-align: right;">9.75</td>
<td style="text-align: right;">-22.23</td>
<td style="text-align: right;">16.56</td>
<td style="text-align: right;">2047.43</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes MI</td>
<td style="text-align: right;">-5.52</td>
<td style="text-align: right;">10.24</td>
<td style="text-align: right;">-25.29</td>
<td style="text-align: right;">14.89</td>
<td style="text-align: right;">85499.19</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">-82.60</td>
<td style="text-align: right;">49.54</td>
<td style="text-align: right;">-180.82</td>
<td style="text-align: right;">15.62</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comparison-of-methods-beta_3" class="level2 small">
<h2 class="small anchored" data-anchor-id="comparison-of-methods-beta_3">Comparison of methods: <span class="math inline">\(\beta_3\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
<th style="text-align: right;">n_eff</th>
<th style="text-align: right;">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes Joint</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">2487.34</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes MI</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">83444.33</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="comparison-of-methods-sigma" class="level2 small">
<h2 class="small anchored" data-anchor-id="comparison-of-methods-sigma">Comparison of methods: <span class="math inline">\(\sigma\)</span></h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
<th style="text-align: right;">n_eff</th>
<th style="text-align: right;">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">8.73</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">8.07</td>
<td style="text-align: right;">9.49</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes Joint</td>
<td style="text-align: right;">8.21</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">7.17</td>
<td style="text-align: right;">9.45</td>
<td style="text-align: right;">599.95</td>
<td style="text-align: right;">1.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">Bayes MI</td>
<td style="text-align: right;">8.36</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">7.71</td>
<td style="text-align: right;">9.09</td>
<td style="text-align: right;">151152.94</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAR</td>
<td style="text-align: left;">OLS</td>
<td style="text-align: right;">7.87</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">6.84</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="prepare-for-next-class" class="level2">
<h2 class="anchored" data-anchor-id="prepare-for-next-class">Prepare for next class</h2>
<ul>
<li><p>Work on <a href="https://biostat725-sp25.netlify.app/hw/hw-03">HW 03</a>.</p></li>
<li><p>Complete reading to prepare for Thursdayâ€™s lecture</p></li>
<li><p>Thursdayâ€™s lecture: Hierarchical Models</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/biostat725-sp26\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Â© Copyright 2026, Samuel Berchuck</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/biostat725-sp26/website/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This site is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>